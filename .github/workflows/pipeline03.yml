name: Pipeline 03 - Auto Remediation

on:
  push:
    branches:
      - main

jobs:
  remediation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install SCA tools
        run: |
          npm install -g snyk
          pip install safety

      - name: Auto Remediation Node.js
        run: |
          snyk fix || true   # Ne bloque pas le pipeline si aucune vulnérabilité à corriger

      - name: Auto Remediation Python
        run: |
          safety check --full-report || true   # Même logique pour Python

      - name: Upload report after remediation
        uses: actions/upload-artifact@v4
        with:
          name: Remediation Report
          path: |
            sca-report.txt
            sca-report.json
